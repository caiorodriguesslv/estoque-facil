<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      lang="pt-BR">

<h:head>
    <title>Estoque F√°cil - Dashboard</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Sistema de Controle de Estoque - Dashboard Principal"/>
    <meta name="keywords" content="estoque, controle, gest√£o, produtos, usu√°rios, pagamentos"/>
    <meta name="author" content="Estoque F√°cil"/>
    
    
    <h:outputStylesheet library="css" name="styles.css" />
    <h:outputStylesheet library="css" name="layout.css" />
    <h:outputStylesheet library="css" name="dashboard.css" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="#{request.contextPath}/resources/images/favicon.ico"/>
</h:head>

<h:body>
    <h:form id="dashboardForm">
        <!-- Mensagens do Sistema -->
        <p:messages id="messages" showDetail="true" autoUpdate="true" closable="true" />
        
        <!-- Loading Overlay -->
        <div id="loadingOverlay" class="loading-overlay" style="display: none;">
            <div class="loading-spinner"></div>
        </div>
        
        <div class="dashboard-layout">
            <nav class="dashboard-sidebar" role="navigation" aria-label="Menu principal">
                <h2>üì¶ Estoque F√°cil</h2>

                <p:link value="üè† Dashboard" 
                       outcome="index?faces-redirect=true" 
                       styleClass="nav-link" 
                       icon="pi pi-home"
                       title="Ir para Dashboard"
                       aria-label="Ir para Dashboard" />
                       
                <p:link value="üë• Usu√°rios" 
                       outcome="users?faces-redirect=true" 
                       styleClass="nav-link" 
                       icon="pi pi-users"
                       title="Gerenciar Usu√°rios"
                       aria-label="Gerenciar Usu√°rios" />
                       
                <p:link value="üì¶ Produtos" 
                       outcome="products?faces-redirect=true" 
                       styleClass="nav-link" 
                       icon="pi pi-box"
                       title="Gerenciar Produtos"
                       aria-label="Gerenciar Produtos" />
                       
                <p:link value="üí∞ Pagamentos" 
                       outcome="payments?faces-redirect=true" 
                       styleClass="nav-link" 
                       icon="pi pi-money-bill"
                       title="Gerenciar Pagamentos"
                       aria-label="Gerenciar Pagamentos" />
            </nav>

            <!-- Conte√∫do Principal -->
            <main class="dashboard-content" role="main">
                <!-- Header do Dashboard -->
                <header class="dashboard-header">
                    <h1>Bem-vindo ao Sistema</h1>
                    <h2>Sistema de Controle de Estoque</h2>
                    <p>Gerencie seus produtos, usu√°rios e pagamentos de forma simples e eficiente.</p>
                </header>

                <!-- Estat√≠sticas Principais -->
                <section class="stats-container" aria-label="Estat√≠sticas do sistema">
                    <!-- Card de Usu√°rios -->
                    <div class="stat-card users" tabindex="0" role="button" 
                         onclick="window.location.href='users.xhtml'"
                         aria-label="#{dashboardBean.totalUsers} usu√°rios cadastrados. Clique para gerenciar usu√°rios.">
                        <div class="stat-card-header">
                            <h3 class="stat-card-title">Usu√°rios Cadastrados</h3>
                            <i class="stat-card-icon pi pi-users" aria-hidden="true"></i>
                        </div>
                        <p class="stat-card-value">#{dashboardBean.totalUsers}</p>
                        <p class="stat-card-description">Total de usu√°rios no sistema</p>
                    </div>

                    <!-- Card de Produtos -->
                    <div class="stat-card products" tabindex="0" role="button"
                         onclick="window.location.href='products.xhtml'"
                         aria-label="#{dashboardBean.totalProducts} produtos em estoque. Clique para gerenciar produtos.">
                        <div class="stat-card-header">
                            <h3 class="stat-card-title">Produtos em Estoque</h3>
                            <i class="stat-card-icon pi pi-shopping-cart" aria-hidden="true"></i>
                        </div>
                        <p class="stat-card-value">#{dashboardBean.totalProducts}</p>
                        <p class="stat-card-description">Total de produtos cadastrados</p>
                    </div>

                    <!-- Card de Produtos Vencidos -->
                    <div class="stat-card expired" tabindex="0" role="button"
                         onclick="window.location.href='products.xhtml'"
                         aria-label="#{dashboardBean.expiredProducts} produtos vencidos. Clique para verificar produtos.">
                        <div class="stat-card-header">
                            <h3 class="stat-card-title">Produtos Vencidos</h3>
                            <i class="stat-card-icon pi pi-exclamation-triangle" aria-hidden="true"></i>
                        </div>
                        <p class="stat-card-value #{dashboardBean.expiredProductsClass}">#{dashboardBean.expiredProducts}</p>
                        <p class="stat-card-description">
                            <span class="status-badge #{dashboardBean.expiredProductsBadgeClass}">
                                #{dashboardBean.expiredProductsStatus}
                            </span>
                        </p>
                    </div>
                </section>

                <!-- A√ß√µes R√°pidas -->
                <section class="actions-container" aria-label="A√ß√µes r√°pidas">
                    <h3 class="actions-header">‚ö° A√ß√µes R√°pidas</h3>
                    <div class="actions-grid">
                        <p:commandButton value="‚ûï Novo Usu√°rio" 
                                        action="#{dashboardBean.goToUsers}"
                                        icon="pi pi-user-plus"
                                        styleClass="ui-button-success"
                                        title="Cadastrar novo usu√°rio"
                                        aria-label="Cadastrar novo usu√°rio" />
                                        
                        <p:commandButton value="üì¶ Novo Produto" 
                                        action="#{dashboardBean.goToProducts}"
                                        icon="pi pi-plus"
                                        styleClass="ui-button-info"
                                        title="Cadastrar novo produto"
                                        aria-label="Cadastrar novo produto" />
                                        
                        <p:commandButton value="üí∞ Novo Pagamento" 
                                        action="#{dashboardBean.goToPayments}"
                                        icon="pi pi-money-bill"
                                        styleClass="ui-button-warning"
                                        title="Registrar novo pagamento"
                                        aria-label="Registrar novo pagamento" />
                                        
                        <p:commandButton value="üîÑ Atualizar Dados" 
                                        action="#{dashboardBean.refreshStatistics}"
                                        update="@form"
                                        icon="pi pi-refresh"
                                        styleClass="ui-button-secondary"
                                        title="Atualizar estat√≠sticas"
                                        aria-label="Atualizar estat√≠sticas do sistema"
                                        onclick="showLoading();"
                                        oncomplete="hideLoading();" />
                    </div>
                </section>

                <!-- Status do Sistema -->
                <section class="system-status" aria-label="Status do sistema">
                    <h4>Status do Sistema</h4>
                    <p>
                        <span class="status-badge #{dashboardBean.systemStatusClass}">
                            #{dashboardBean.systemStatus}
                        </span>
                    </p>
                    
                    <h:panelGroup rendered="#{dashboardBean.hasError}">
                        <p style="color: #dc3545; margin-top: 10px;">
                            <i class="pi pi-exclamation-triangle" aria-hidden="true"></i>
                            #{dashboardBean.errorMessage}
                        </p>
                        <p:commandButton value="üîß Tentar Novamente" 
                                        action="#{dashboardBean.retryInitialization}"
                                        update="@form"
                                        icon="pi pi-replay"
                                        styleClass="ui-button-danger ui-button-sm"
                                        title="Tentar reconectar com o sistema"
                                        aria-label="Tentar reconectar com o sistema" />
                    </h:panelGroup>
                </section>
            </main>
        </div>
    </h:form>

    <!-- Scripts -->
    <script type="text/javascript">
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Keyboard navigation para cards
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.stat-card[role="button"]');
            cards.forEach(card => {
                card.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        this.click();
                    }
                });
            });
        });
    </script>
</h:body>
</html>